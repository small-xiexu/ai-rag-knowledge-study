# é¡¹ç›®å¼€å‘æŒ‡å—

> æœ€åæ›´æ–°ï¼š2025-12-28

---

## ğŸ“‹ ç›®å½•

- [1. API æ”¹é€ è¯´æ˜](#1-api-æ”¹é€ è¯´æ˜)
- [2. Java ç‰ˆæœ¬åˆ‡æ¢](#2-java-ç‰ˆæœ¬åˆ‡æ¢)
- [3. å¿«é€Ÿå¼€å§‹](#3-å¿«é€Ÿå¼€å§‹)

---

## 1. API æ”¹é€ è¯´æ˜

### æ”¹é€ å†…å®¹

å°† `OllamaController` çš„ä¸¤ä¸ªæ¥å£ä» GET æ”¹ä¸º POSTï¼š

| æ”¹é€ é¡¹ | æ”¹é€ å‰ | æ”¹é€ å |
|--------|--------|--------|
| **è¯·æ±‚æ–¹å¼** | GET | POST |
| **å‚æ•°ä¼ é€’** | URL æŸ¥è¯¢å‚æ•° | JSON è¯·æ±‚ä½“ |
| **Content-Type** | - | `application/json` |

### æ”¹é€ åŸå› 

1. âœ… è§£å†³ URL é•¿åº¦é™åˆ¶ï¼ˆæ”¯æŒé•¿æ–‡æœ¬æ¶ˆæ¯ï¼‰
2. âœ… æå‡å®‰å…¨æ€§ï¼ˆé¿å…å‚æ•°æš´éœ²åœ¨ URL ä¸­ï¼‰
3. âœ… ç¬¦åˆ RESTful è¯­ä¹‰ï¼ˆç”Ÿæˆæ“ä½œåº”ä½¿ç”¨ POSTï¼‰

### API ä½¿ç”¨ç¤ºä¾‹

#### åŒæ­¥ç”Ÿæˆæ¥å£

**è¯·æ±‚ï¼š**
```bash
curl -X POST http://localhost:8090/api/v1/ollama/generate \
  -H "Content-Type: application/json" \
  -d '{
    "model": "deepseek-r1:1.5b",
    "message": "ä½ å¥½ï¼Œä»‹ç»ä¸€ä¸‹è‡ªå·±"
  }'
```

#### æµå¼ç”Ÿæˆæ¥å£

**è¯·æ±‚ï¼š**
```bash
curl -X POST http://localhost:8090/api/v1/ollama/generate_stream \
  -H "Content-Type: application/json" \
  -d '{
    "model": "deepseek-r1:1.5b",
    "message": "ç”¨Pythonå†™ä¸€ä¸ªå¿«é€Ÿæ’åº"
  }'
```

### Postman é…ç½®

1. **Method**: `POST`
2. **URL**: `http://localhost:8090/api/v1/ollama/generate`
3. **Headers**: `Content-Type: application/json`
4. **Body** (raw - JSON):
   ```json
   {
     "model": "deepseek-r1:1.5b",
     "message": "ä½ å¥½"
   }
   ```

---

## 2. Java ç‰ˆæœ¬åˆ‡æ¢

### å¿«é€Ÿåˆ‡æ¢å‘½ä»¤

æœ¬é¡¹ç›®éœ€è¦ **Java 17**ï¼Œå¦‚éœ€åˆ‡æ¢åˆ°å…¶ä»–ç‰ˆæœ¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

| å‘½ä»¤ | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| `java8` | åˆ‡æ¢åˆ° Java 8 | ç”¨äºæ—§é¡¹ç›® |
| `java17` | åˆ‡æ¢åˆ° Java 17 | **æœ¬é¡¹ç›®ä½¿ç”¨** |
| `java21` | åˆ‡æ¢åˆ° Java 21 | å¤‡ç”¨ |
| `javaversion` | æŸ¥çœ‹å½“å‰ç‰ˆæœ¬ | æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ |
| `javalist` | åˆ—å‡ºæ‰€æœ‰ç‰ˆæœ¬ | æŸ¥çœ‹å·²å®‰è£…çš„ Java |

### ä½¿ç”¨ç¤ºä¾‹

```bash
# åˆ‡æ¢åˆ° Java 17ï¼ˆæœ¬é¡¹ç›®ï¼‰
java17

# åˆ‡æ¢åˆ° Java 8ï¼ˆæ—§é¡¹ç›®ï¼‰
java8

# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
java -version

# æˆ–ä½¿ç”¨è¯¦ç»†æŸ¥çœ‹
javaversion
```

### åˆ‡æ¢æ•ˆæœ

æ‰§è¡Œ `java17` åä¼šçœ‹åˆ°ï¼š
```
âœ… å·²åˆ‡æ¢åˆ° Java 17
java version "17.0.13" 2024-10-15 LTS
Java(TM) SE Runtime Environment (build 17.0.13+10-LTS-268)
Java HotSpot(TM) 64-Bit Server VM (build 17.0.13+10-LTS-268, mixed mode, sharing)
```

### æ³¨æ„äº‹é¡¹

- âœ… é»˜è®¤å¯åŠ¨ç»ˆç«¯ä½¿ç”¨ Java 17
- âœ… åˆ‡æ¢åœ¨å½“å‰ç»ˆç«¯ä¼šè¯æœ‰æ•ˆ
- âœ… æ–°ç»ˆç«¯è‡ªåŠ¨ä½¿ç”¨é»˜è®¤ç‰ˆæœ¬ï¼ˆJava 17ï¼‰

---

## 3. å¿«é€Ÿå¼€å§‹

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# 1. åˆ‡æ¢åˆ° Java 17
java17

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/xiexu/xiaofu/ai-rag-knowledge-study

# 3. ç¼–è¯‘é¡¹ç›®
mvn clean compile -DskipTests
```

### å¯åŠ¨åº”ç”¨

```bash
# ç¡®ä¿ä½¿ç”¨ Java 17
java17

# å¯åŠ¨ Spring Boot åº”ç”¨
mvn spring-boot:run
```

### æµ‹è¯•æ¥å£

å¯åŠ¨åæµ‹è¯• POST æ¥å£ï¼š

```bash
# æµ‹è¯•åŒæ­¥æ¥å£
curl -X POST http://localhost:8090/api/v1/ollama/generate \
  -H "Content-Type: application/json" \
  -d '{"model":"deepseek-r1:1.5b","message":"1+1ç­‰äºå‡ ï¼Ÿ"}'

# æµ‹è¯•æµå¼æ¥å£
curl -X POST http://localhost:8090/api/v1/ollama/generate_stream \
  -H "Content-Type: application/json" \
  -d '{"model":"deepseek-r1:1.5b","message":"hi"}'
```

### å¸¸ç”¨å‘½ä»¤

```bash
# ç¼–è¯‘ï¼ˆè·³è¿‡æµ‹è¯•ï¼‰
mvn clean compile -DskipTests

# æ‰“åŒ…
mvn clean package -DskipTests

# è¿è¡Œæµ‹è¯•
mvn test

# å¯åŠ¨åº”ç”¨
mvn spring-boot:run
```

---

## 4. ä»£ç ç»“æ„

### æ–°å¢æ–‡ä»¶

```
xfg-dev-tech-api/
â””â”€â”€ src/main/java/com/xbk/xfg/dev/tech/api/
    â””â”€â”€ dto/
        â””â”€â”€ OllamaRequest.java  â­ è¯·æ±‚ DTO
```

### ä¿®æ”¹æ–‡ä»¶

```
xfg-dev-tech-api/
â””â”€â”€ src/main/java/com/xbk/xfg/dev/tech/api/
    â””â”€â”€ IAiService.java  âœï¸ æ¥å£å®šä¹‰

xfg-dev-tech-trigger/
â””â”€â”€ src/main/java/com/xbk/xfg/dev/tech/trigger/http/
    â””â”€â”€ OllamaController.java  âœï¸ æ§åˆ¶å™¨å®ç°
```

### è¯·æ±‚ DTO å®šä¹‰

```java
@Data
public class OllamaRequest {
    private String model;    // æ¨¡å‹åç§°
    private String message;  // æ¶ˆæ¯å†…å®¹
}
```

---

## 5. æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šJava ç‰ˆæœ¬åˆ‡æ¢ä¸ç”Ÿæ•ˆ

**è§£å†³ï¼š**
```bash
# é‡æ–°åŠ è½½é…ç½®
source ~/.zshrc

# å†æ¬¡åˆ‡æ¢
java17
```

### é—®é¢˜2ï¼šç¼–è¯‘å¤±è´¥ï¼ˆJava ç‰ˆæœ¬é”™è¯¯ï¼‰

**ç°è±¡ï¼š** `æ— æ•ˆçš„ç›®æ ‡å‘è¡Œç‰ˆ: 17`

**è§£å†³ï¼š**
```bash
# ç¡®è®¤å½“å‰ Java ç‰ˆæœ¬
java -version

# å¦‚æœä¸æ˜¯ 17ï¼Œåˆ‡æ¢
java17

# é‡æ–°ç¼–è¯‘
mvn clean compile -DskipTests
```

### é—®é¢˜3ï¼šæ¥å£è¯·æ±‚å¤±è´¥

**æ£€æŸ¥æ¸…å•ï¼š**
- âœ… åº”ç”¨æ˜¯å¦å·²å¯åŠ¨ï¼Ÿ
- âœ… ç«¯å£æ˜¯å¦æ­£ç¡®ï¼ˆ8090ï¼‰ï¼Ÿ
- âœ… Content-Type æ˜¯å¦è®¾ç½®ä¸º `application/json`ï¼Ÿ
- âœ… JSON æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Ÿ

---

## 6. å¤‡ä»½ä¿¡æ¯

### é…ç½®æ–‡ä»¶å¤‡ä»½

- `~/.zshrc.backup.*` - zsh é…ç½®å¤‡ä»½

### æ¢å¤æ–¹æ³•

å¦‚éœ€æ¢å¤æ—§é…ç½®ï¼š
```bash
# æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶
ls -la ~/.zshrc.backup.*

# æ¢å¤ï¼ˆæ›¿æ¢æ—¶é—´æˆ³ï¼‰
cp ~/.zshrc.backup.20251228_XXXXXX ~/.zshrc
source ~/.zshrc
```

---

## ğŸ’¡ å°è´´å£«

### å¼€å‘å·¥ä½œæµ

```bash
# 1. æ—©ä¸Šæ‰“å¼€ç»ˆç«¯ï¼Œé»˜è®¤æ˜¯ Java 17
cd ~/project

# 2. éœ€è¦å¼€å‘ Java 8 é¡¹ç›®
java8
cd ~/old-project
mvn clean install

# 3. å›åˆ° Java 17 é¡¹ç›®
java17
cd ~/new-project
mvn spring-boot:run
```

### ä¸€é”®å¯åŠ¨

åˆ›å»ºé¡¹ç›®å¯åŠ¨è„šæœ¬ `start.sh`ï¼š

```bash
#!/bin/bash
java17
cd /Users/xiexu/xiaofu/ai-rag-knowledge-study
mvn spring-boot:run
```

ä½¿ç”¨ï¼š
```bash
chmod +x start.sh
./start.sh
```

---

**æœ‰é—®é¢˜ï¼ŸæŸ¥çœ‹è¿™ä»½æ–‡æ¡£å°±å¤Ÿäº†ï¼** ğŸ“–
